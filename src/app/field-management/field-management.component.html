
<h5>{{languageService.i18n['index.menu_fieldMgr']}}
  <mat-icon tooltip="{{languageService.i18n['field.create']}}" (click)="openfieldCreationWindow()">add</mat-icon>
</h5>
<div class="table">
  <table>
    <thead>
      <tr>
        <th>{{languageService.i18n['field.name']}}</th>
        <th>{{languageService.i18n['field.bsNum']}}</th>
        <th class="icon">{{languageService.i18n['field.view']}}</th>
        <th class="icon">{{languageService.i18n['field.alarm']}}</th>
        <th class="icon">{{languageService.i18n['field.snapshot']}}</th>
        <th class="icon">{{languageService.i18n['field.delTitle']}}</th>
    </thead>
    <tbody>
        <!-- 顯示進度條 -->
        <ng-container *ngIf="isLoading">
          <tr>
            <td colspan="6">
              <div class="progress-spinner-container">
                                                                                  <!-- diameter: 指示器大小-->
                <mat-progress-spinner class="custom-spinner-color" mode="indeterminate" [diameter]="90"></mat-progress-spinner>
              </div>
            </td>
          </tr>
        </ng-container>
        <!-- 顯示數據 -->
        <ng-container *ngIf="!isLoading">
          <tr *ngFor="let opt of fieldList.fields | paginate: { itemsPerPage: pageSize, currentPage: p, totalItems: totalItems, id: 'fieldsListDisplay' };">
            <td>{{opt.name}}</td>
            <td>{{opt.bsNum}}</td>
            <td class="icon">
              <mat-icon tooltip="{{ languageService.i18n['field.view'] }}" (click)="viewFieldDetail(opt)">remove_red_eye</mat-icon>
            </td>
            <td class="icon">
              <mat-icon tooltip="{{ languageService.i18n['field.alarm'] }}" (click)="viewFieldAlarm(opt)">warning</mat-icon>
            </td>
            <td class="icon">
              <mat-icon tooltip="{{languageService.i18n['field.snapshot']}}" (click)="openSnapshot(opt)">camera_alt</mat-icon>
            </td>
            <td class="icon">
              <mat-icon tooltip="{{languageService.i18n['field.delItem']}}" (click)="openDeleteField_ConfirmWindow(opt)">delete_forever</mat-icon>
            </td>
          </tr>
        </ng-container>
    </tbody>
  </table>
</div>
<pagination-controls (pageChange)="pageChanged($event)" screenReaderPaginationLabel="Pagination" previousLabel="" nextLabel="" id="fieldsListDisplay">
</pagination-controls>


<!-- Window of Create Field @2024/02/02 Update -->
<ng-template #fieldCreationWindow>
  <div>
    <!-- 欄位標題 - 場域建立 -->
    <h5>{{ languageService.i18n['field.createTitle'] }}</h5>
  </div>  
  <mat-stepper class="custom-stepper" orientation="vertical" [linear]="true" #stepper> 
    <!-- 定義垂直方向的 mat-stepper，並設置為線性步驟，要求每個步驟完成後才能進行下一步 -->
    <mat-step [stepControl]="firstFormGroup_FieldName">
      <!-- 第一步：設置場域名稱 -->
      <form [formGroup]="firstFormGroup_FieldName">
        <!-- 使用 firstFormGroup_FieldName 這個 FormGroup -->
        <ng-template matStepLabel>{{ languageService.i18n['field.setFieldName'] }}</ng-template>
        <!-- 步驟標籤：設置場域名稱 -->
        <mat-form-field appearance="fill">
          <!-- 定義一個填滿式樣的表單欄位 -->
          <mat-label>{{ languageService.i18n['field.name'] }}</mat-label>
          <!-- 欄位標籤：場域名稱 -->
          <input matInput formControlName="FieldName" required>
          <!-- 輸入欄位綁定到 FormGroup 的 FieldName 控件，並設置為必填 -->
        </mat-form-field>
        <div>
          <button mat-button matStepperNext>{{ languageService.i18n['field.createNext'] }}</button>
          <!-- 下一步按鈕 -->
        </div>
      </form>
    </mat-step>
    <mat-step [stepControl]="secondFormGroup_fieldBounds">
      <!-- 第二步：設置場域邊界座標 -->
      <form [formGroup]="secondFormGroup_fieldBounds">
        <!-- 使用 secondFormGroup_fieldBounds 這個 FormGroup -->
        <ng-template matStepLabel>{{ languageService.i18n['field.setFieldBoundsCoord'] }}</ng-template>
        <!-- 步驟標籤：設置場域邊界座標 -->
        <div class="mat-stepper-boundary-group">
          <!-- 包含邊界座標欄位的容器 -->
          <div class="mat-stepper-boundary-row">
            <!-- 第一行邊界座標欄位 -->
            <!-- 北邊界欄位與錯誤提示，其他欄位類似，僅註解一次 -->
            <mat-form-field appearance="fill">
              <mat-label>{{ languageService.i18n['field.northBound'] }}</mat-label>
              <input matInput formControlName="northBound" placeholder="{{ languageService.i18n['field.lat'] }} ( -90.0 ~ 90.0 )" required>
              <mat-error *ngIf="secondFormGroup_fieldBounds.get('northBound')?.hasError('pattern')">{{ languageService.i18n['field.validLatitude'] }}</mat-error>
              <!-- 如果 northBound 控件的 pattern 驗證器失敗，則顯示錯誤提示 -->
            </mat-form-field>
            <!-- 南邊界欄位，類似於北邊界 -->
            <mat-form-field appearance="fill">
              <mat-label>{{ languageService.i18n['field.southBound'] }}</mat-label>
              <input matInput formControlName="southBound" placeholder="{{ languageService.i18n['field.lat'] }} ( -90.0 ~ 90.0 )" required>
              <mat-error *ngIf="secondFormGroup_fieldBounds.get('southBound')?.hasError('pattern')">{{ languageService.i18n['field.validLatitude'] }}</mat-error>
            </mat-form-field>
          </div>
          <div class="mat-stepper-boundary-row">
            <!-- 西邊界與東邊界欄位，類似於北邊界 -->
            <mat-form-field appearance="fill">
              <mat-label>{{ languageService.i18n['field.westBound'] }}</mat-label>
              <input matInput formControlName="westBound" placeholder="{{ languageService.i18n['field.lng'] }} ( -180.0 ~ 180.0 )" required>
              <mat-error *ngIf="secondFormGroup_fieldBounds.get('westBound')?.hasError('pattern')">{{ languageService.i18n['field.validLongitude'] }}</mat-error>
            </mat-form-field>
            <mat-form-field appearance="fill">
              <mat-label>{{ languageService.i18n['field.eastBound'] }}</mat-label>
              <input matInput formControlName="eastBound" placeholder="{{ languageService.i18n['field.lng'] }} ( -180.0 ~ 180.0 )" required>
              <mat-error *ngIf="secondFormGroup_fieldBounds.get('eastBound')?.hasError('pattern')">{{ languageService.i18n['field.validLongitude'] }}</mat-error>
            </mat-form-field>
          </div>
        </div>
        <div>
          <!-- 下一步與上一步按鈕，類似於第一步 -->
          <button mat-button matStepperPrevious>{{ languageService.i18n['field.createBack'] }}</button>
          <button mat-button matStepperNext>{{ languageService.i18n['field.createNext'] }}</button>
        </div>
      </form>
    </mat-step>    
    <mat-step [stepControl]="thirdFormGroup_PhoneNum">
      <!-- 第三步：設置場域管理者的通知電話號碼 -->
      <form [formGroup]="thirdFormGroup_PhoneNum">
        <!-- 使用 thirdFormGroup_PhoneNum 這個 FormGroup -->
        <ng-template matStepLabel>{{ languageService.i18n['field.setNotificationNum'] }}</ng-template>
        <!-- 步驟標籤：設置通知電話號碼 -->
        <mat-form-field appearance="fill">
          <mat-label>{{ languageService.i18n['field.PhoneNum'] }}</mat-label>
          <input matInput formControlName="PhoneNum" placeholder="09xxxxxxxx" required>
          <mat-error *ngIf="thirdFormGroup_PhoneNum.get('PhoneNum')?.hasError('pattern')">{{ languageService.i18n['field.validPhoneNumber'] }}</mat-error>
          <!-- 如果 PhoneNum 控件的 pattern 驗證器失敗，則顯示錯誤提示 -->
        </mat-form-field>
        <div>
          <!-- 下一步與上一步按鈕，類似於第一步 -->
          <button mat-button matStepperPrevious>{{ languageService.i18n['field.createBack'] }}</button>
          <button mat-button matStepperNext>{{ languageService.i18n['field.createNext'] }}</button>
        </div>
      </form>
    </mat-step>
    <!-- 場域建立的步驟 -->
    <mat-step>
      <!-- 表單元素 -->
      <form>
        <!-- 步驟標籤 -->
        <ng-template matStepLabel>{{ languageService.i18n['field.selectBaseStations'] }}</ng-template>
        <!-- 表格容器 -->
        <div class="table">
          <!-- 表格元素 -->
          <table class="center">
            <!-- 表格頭部 -->
            <thead>
              <tr>
                <!-- 全選框所在的表頭 -->
                <th>
                  <input type="checkbox" [checked]="isAllSelected" (change)="onSelectAllBs($event)">
                </th>
                <!-- 基站名稱表頭 -->
                <th>{{ languageService.i18n['field.BSname'] }}</th>
                <!-- gNB ID 表頭 -->
                <th>gNB ID</th>
                <!-- gNB ID 長度表頭 -->
                <th>gNB ID Length</th>
                <!-- 基站天線座標表頭 -->
                <th>{{ languageService.i18n['field.bsAntennaCoord'] }}</th>
                <!-- 基站描述表頭 -->
                <th>{{ languageService.i18n['field.bsDescription'] }}</th>
              </tr>
            </thead>
            <!-- 表格內容 -->
            <tbody>
              <!-- 循環顯示所有基站 -->
              <tr *ngFor="let opt of displayedBSs" style="overflow-y: auto;">
                <!-- 基站選擇框 -->
                <td>
                  <input type="checkbox" [checked]="opt.selected" (change)="onBsSelectionChange( opt.id, $event )">
                </td>
                <!-- 顯示基站名稱 -->
                <td>{{ opt.name }}</td>
                <!-- 顯示 gNB ID -->
                <td>{{ opt.gNBId }}</td>
                <!-- 顯示 gNB ID 長度 -->
                <td>{{ opt.gNBIdLength }}</td>
                <!-- 顯示基站天線座標 -->
                <td>{{ opt.position }}</td>
                <!-- 顯示基站描述 -->
                <td>{{ opt.description }}</td>
              </tr>
            </tbody>
          </table>
        </div>
        <!-- 操作按鈕 -->
        <div>
          <!-- 上一步按鈕 -->
          <button mat-button matStepperPrevious>{{ languageService.i18n['field.createBack'] }}</button>
          <!-- 下一步按鈕 -->
          <button mat-button matStepperNext>{{ languageService.i18n['field.createNext'] }}</button>
        </div>
      </form>
    </mat-step>
    <!-- 步驟完成提示 -->
    <mat-step>
      <!-- 步驟標籤 -->
      <ng-template matStepLabel>{{ languageService.i18n['field.createDone'] }}</ng-template>
      <!-- 完成提示訊息 -->
      <p>{{ languageService.i18n['field.setupComplete'] }}</p>
      <!-- 操作按鈕 -->
      <div>
        <!-- 上一步按鈕 -->
        <button mat-button matStepperPrevious>{{ languageService.i18n['field.createBack'] }}</button>
        <!-- 重置步驟按鈕 -->
        <button mat-button (click)="stepper.reset()">{{ languageService.i18n['field.createReset'] }}</button>
      </div>
    </mat-step>
  </mat-stepper>
  <!-- 按鈕組容器，用於對齊並中心顯示按鈕 -->
  <div class="buttons buttons-centered">
    <!-- 確認按鈕：點擊時呼叫 FieldCreation_Submit() 方法來提交場域建立的資料，並關閉對話框 -->
    <button type="button" (click)="FieldCreation_Submit()" mat-dialog-close>
      {{ languageService.i18n['confirm'] }}
    </button>
    <!-- 取消按鈕：點擊時呼叫 resetFieldCreationForm() 方法來重置場域建立的表單，並關閉對話框 -->
    <button type="button" (click)="resetFieldCreationForm()" mat-dialog-close>
      {{ languageService.i18n['cancel'] }}
    </button>
  </div>
</ng-template>

<!-- Confirm Window of Delete Field @2024/01/29 Update -->
<ng-template #deleteField_ConfirmWindow>
  <!-- 標題部分，使用 languageService.i18n['confirm'] 來國際化確認文字 -->
  <h5>{{languageService.i18n['confirm']}}</h5>
  
  <!-- 確認刪除的提示信息，展示場域名稱-->
  <p>{{languageService.i18n['confirm_del_field']}} - {{selectField.name}} ?</p>
  
  <!-- 按鈕容器 -->
  <div class="buttons">
    <!-- 確認按鈕，點擊時呼叫 confirmDeleteField() 函數處理確認邏輯，並且關閉視窗 -->
    <button type="button" (click)="confirmDeleteField()" mat-dialog-close>
      {{ languageService.i18n['confirm'] }} <!-- 按鈕文字 -->
    </button>
    
    <!-- 取消按鈕，點擊時不進行任何操作，直接關閉視窗 -->
    <button type="button" mat-dialog-close>
      {{ languageService.i18n['cancel'] }} <!-- 按鈕文字 -->
    </button>
  </div>
</ng-template>
